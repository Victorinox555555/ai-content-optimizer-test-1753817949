{% extends "base.html" %}

{% block title %}Dashboard - Test-frontend_build{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <div class="px-4 py-6 sm:px-0">
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-gray-900">AI Content Optimizer</h1>
                <p class="mt-2 text-sm text-gray-600">Transform your content with AI-powered optimization to boost engagement and impact.</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <span class="text-2xl">üìä</span>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 truncate">Current Plan</dt>
                                    <dd class="text-lg font-medium text-gray-900">Free</dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <span class="text-2xl">‚úÖ</span>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 truncate">Status</dt>
                                    <dd class="text-lg font-medium text-gray-900">Active</dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <span class="text-2xl">üöÄ</span>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 truncate">Usage</dt>
                                    <dd class="text-lg font-medium text-gray-900" id="usage-counter">0/100</dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- AI Content Optimization Interface -->
            <div class="bg-white shadow rounded-lg p-6 mb-8">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Optimize Your Content</h3>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Input Section -->
                    <div>
                        <label for="content-input" class="block text-sm font-medium text-gray-700 mb-2">
                            Original Content
                        </label>
                        <textarea 
                            id="content-input" 
                            rows="12" 
                            class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                            placeholder="Paste your content here to optimize it for better engagement..."
                        ></textarea>
                        
                        <div class="mt-4">
                            <label for="target-audience" class="block text-sm font-medium text-gray-700 mb-2">
                                Target Audience
                            </label>
                            <select id="target-audience" class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-indigo-500">
                                <option value="general">General Audience</option>
                                <option value="business">Business Professionals</option>
                                <option value="marketing">Marketing Teams</option>
                                <option value="social">Social Media</option>
                                <option value="technical">Technical Audience</option>
                            </select>
                        </div>
                        
                        <button 
                            id="optimize-btn" 
                            class="mt-4 w-full bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors font-medium"
                            onclick="optimizeContent()"
                        >
                            üöÄ Optimize Content
                        </button>
                    </div>
                    
                    <!-- Results Section -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Optimized Content
                        </label>
                        <div 
                            id="optimized-content" 
                            class="w-full h-64 border border-gray-300 rounded-lg p-3 bg-gray-50 overflow-y-auto"
                        >
                            <p class="text-gray-500 italic">Your optimized content will appear here...</p>
                        </div>
                        
                        <!-- Engagement Score -->
                        <div class="mt-4 p-4 bg-indigo-50 rounded-lg">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm font-medium text-gray-700">Engagement Score</span>
                                <span id="engagement-score" class="text-2xl font-bold text-indigo-600">--</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="engagement-bar" class="bg-indigo-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <!-- Improvements List -->
                        <div class="mt-4">
                            <h4 class="text-sm font-medium text-gray-700 mb-2">Key Improvements</h4>
                            <ul id="improvements-list" class="text-sm text-gray-600 space-y-1">
                                <li class="text-gray-400 italic">Optimize content to see improvements...</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="bg-white shadow rounded-lg p-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Quick Actions</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    <button 
                        class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors"
                        onclick="copyOptimizedContent()"
                    >
                        üìã Copy Optimized Content
                    </button>
                    <button 
                        class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition-colors"
                        onclick="clearContent()"
                    >
                        üóëÔ∏è Clear Content
                    </button>
                    <a href="/pricing" class="bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 text-center transition-colors">
                        ‚≠ê Upgrade Plan
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    let usageCount = 0;
    
    async function optimizeContent() {
        const content = document.getElementById('content-input').value.trim();
        const targetAudience = document.getElementById('target-audience').value;
        const optimizeBtn = document.getElementById('optimize-btn');
        
        if (!content) {
            alert('Please enter some content to optimize.');
            return;
        }
        
        if (content.length > 5000) {
            alert('Content is too long. Please limit to 5000 characters.');
            return;
        }
        
        // Show loading state
        optimizeBtn.disabled = true;
        optimizeBtn.innerHTML = '‚è≥ Optimizing...';
        
        try {
            const baseUrl = window.location.protocol + '//' + window.location.host;
            const response = await fetch(baseUrl + '/api/optimize', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    content: content,
                    target_audience: targetAudience
                })
            });
            
            const result = await response.json();
            
            if (result.success) {
                // Display optimized content
                document.getElementById('optimized-content').innerHTML = 
                    `<p class="text-gray-900 whitespace-pre-wrap">${result.optimized}</p>`;
                
                // Update engagement score
                const score = result.engagement_score;
                document.getElementById('engagement-score').textContent = score;
                document.getElementById('engagement-bar').style.width = score + '%';
                
                // Update improvements list
                const improvementsList = document.getElementById('improvements-list');
                if (result.improvements && result.improvements.length > 0) {
                    improvementsList.innerHTML = result.improvements
                        .map(improvement => `<li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span>${improvement}</li>`)
                        .join('');
                } else {
                    improvementsList.innerHTML = '<li class="text-gray-500 italic">No specific improvements identified</li>';
                }
                
                // Update usage counter
                usageCount++;
                document.getElementById('usage-counter').textContent = `${usageCount}/100`;
                
            } else {
                alert('Optimization failed: ' + (result.error || 'Unknown error'));
            }
            
        } catch (error) {
            alert('Network error: ' + error.message);
        } finally {
            // Reset button
            optimizeBtn.disabled = false;
            optimizeBtn.innerHTML = 'üöÄ Optimize Content';
        }
    }
    
    function copyOptimizedContent() {
        const optimizedDiv = document.getElementById('optimized-content');
        const text = optimizedDiv.textContent || optimizedDiv.innerText;
        
        if (text && text !== 'Your optimized content will appear here...') {
            navigator.clipboard.writeText(text).then(() => {
                alert('Optimized content copied to clipboard!');
            }).catch(() => {
                alert('Failed to copy content. Please select and copy manually.');
            });
        } else {
            alert('No optimized content to copy. Please optimize some content first.');
        }
    }
    
    function clearContent() {
        document.getElementById('content-input').value = '';
        document.getElementById('optimized-content').innerHTML = 
            '<p class="text-gray-500 italic">Your optimized content will appear here...</p>';
        document.getElementById('engagement-score').textContent = '--';
        document.getElementById('engagement-bar').style.width = '0%';
        document.getElementById('improvements-list').innerHTML = 
            '<li class="text-gray-400 italic">Optimize content to see improvements...</li>';
    }
    
    // Character counter for input
    document.getElementById('content-input').addEventListener('input', function() {
        const length = this.value.length;
        const maxLength = 5000;
        
        if (length > maxLength * 0.9) {
            this.style.borderColor = length > maxLength ? '#ef4444' : '#f59e0b';
        } else {
            this.style.borderColor = '#d1d5db';
        }
    });
</script>
{% endblock %}
